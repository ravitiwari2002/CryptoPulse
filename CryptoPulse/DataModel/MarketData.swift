//
//  MarketData.swift
//  CryptoPulse
//
//  Created by Ravi Tiwari on 11/17/23.
//

import Foundation

// JSON data:
/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
    "data":{
       "active_cryptocurrencies":10863,
       "upcoming_icos":0,
       "ongoing_icos":49,
       "ended_icos":3376,
       "markets":929,
       "total_market_cap":{
          "btc":39569728.90583371,
          "eth":687413717.1680902,
          "ltc":19795304142.177853,
          "bch":6042277532.273558,
          "bnb":5730952701.002474,
          "eos":2103329076572.527,
          "xrp":2201512967148.1865,
          "xlm":11804199229055.451,
          "link":100988658570.60356,
          "dot":283795939976.43066,
          "yfi":200468832.20874837,
          "usd":1448568373586.7625,
          "aed":5320533693449.234,
          "ars":506981692791722.25,
          "aud":2277662276482.641,
          "bdt":159953580831552.4,
          "bhd":545988597098.8282,
          "bmd":1448568373586.7625,
          "brl":7148684923650.684,
          "cad":1999122858199.1348,
          "chf":1309494221175.4453,
          "clp":1311316520189417.2,
          "cny":10564988575917.676,
          "czk":33332718579498.62,
          "dkk":10130128350166.957,
          "eur":1358302283955.0771,
          "gbp":1184729027158.4167,
          "hkd":11311732815343.52,
          "huf":515524479918113.25,
          "idr":2.2763399185397372e+16,
          "ils":5584687379214.632,
          "inr":120792643006440.38,
          "jpy":219341257411429.75,
          "krw":1912642758457205.2,
          "kwd":447451182053.9602,
          "lkr":475146168128973.75,
          "mmk":3046713835837339.5,
          "mxn":25730927262863.523,
          "myr":6830724165648.357,
          "ngn":1165431199285494.2,
          "nok":16177232071303.076,
          "nzd":2456974761175.448,
          "php":81064780425525.69,
          "pkr":416391671403195.94,
          "pln":6019433168063.897,
          "rub":133380542830387.94,
          "sar":5433429318213.076,
          "sek":15834199491890.762,
          "sgd":1971352353909.103,
          "thb":51945661876821.42,
          "try":41363289031852.164,
          "twd":46901018170100.21,
          "uah":52301821382835.22,
          "vef":145045151247.2425,
          "vnd":3.5223560094219676e+16,
          "zar":27048504495563.594,
          "xdr":1103559946912.8564,
          "xag":63994578380.32496,
          "xau":740609552.3637031,
          "bits":39569728905833.71,
          "sats":3956972890583371.5
       },
       "total_volume":{
          "btc":3746020.510858094,
          "eth":65076662.26586738,
          "ltc":1873998568.7478402,
          "bch":572015431.8483795,
          "bnb":542542669.8222291,
          "eos":199119733184.8107,
          "xrp":208414688649.5686,
          "xlm":1117489900714.9353,
          "link":9560479609.799725,
          "dot":26866633698.196236,
          "yfi":18978152.69416789,
          "usd":137134294039.5116,
          "aed":503688776635.36444,
          "ars":47995371015730.09,
          "aud":215623655770.20227,
          "bdt":15142620663541.004,
          "bhd":51688109572.196556,
          "bmd":137134294039.5116,
          "brl":676757741084.9907,
          "cad":189254650906.52057,
          "chf":123968304737.36624,
          "clp":124140819679267.92,
          "cny":1000175260147.7722,
          "czk":3155569950418.685,
          "dkk":959007545077.1134,
          "eur":128588907640.73349,
          "gbp":112156927991.74304,
          "hkd":1070868674396.6107,
          "huf":48804106801398.75,
          "idr":2154984696717935.5,
          "ils":528695900824.93805,
          "inr":11435299931917.777,
          "jpy":20764783380143.02,
          "krw":181067679795718.72,
          "kwd":42359686354.45262,
          "lkr":44981538683333.125,
          "mmk":288428878219562.44,
          "mxn":2435917150695.314,
          "myr":646656763543.315,
          "ngn":110330024926548.7,
          "nok":1531479866648.2266,
          "nzd":232598961492.1769,
          "php":7674309088770.563,
          "pkr":39419318371850.016,
          "pln":569852782286.3734,
          "rub":12626981862348.76,
          "sar":514376474975.62634,
          "sek":1499005368745.3196,
          "sgd":186625649355.4891,
          "thb":4917635784256.897,
          "try":3915814775446.341,
          "twd":4440065193861.398,
          "uah":4951352993132.394,
          "vef":13731256862.176294,
          "vnd":3334573731662250.5,
          "zar":2560650664793.422,
          "xdr":104472744959.53308,
          "xag":6058292786.561671,
          "xau":70112650.51358101,
          "bits":3746020510858.0938,
          "sats":374602051085809.4
       },
       "market_cap_percentage":{
          "btc":49.37661576225636,
          "eth":17.479604066811103,
          "usdt":5.968659489241484,
          "bnb":2.683067227100357,
          "xrp":2.435344100337621,
          "usdc":1.666293687117678,
          "sol":1.3892998330986535,
          "steth":1.3018260032683497,
          "ada":0.8958814791982073,
          "doge":0.7275419881640793
       },
       "market_cap_change_percentage_24h_usd":1.3175888178017787,
       "updated_at":1699601095
    }
 }
 
 
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return "\(item.value.asPercentageString())"
        }
        return ""
    }
    
}


